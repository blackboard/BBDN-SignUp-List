<!DOCTYPE html>
<html ng-app="signupApp">
  <head>
    <title>SignUp List</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" integrity="sha384-L/tgI3wSsbb3f/nW9V6Yqlaw3Gj7mpE56LWrhew/c8MIhAYWZ/FNirA64AVkB5pI" crossorigin="anonymous">
    <link href="components/ngPrint/ngPrint.min.css" rel="stylesheet">

  </head>
  <body ng-controller="SignupController" data-ng-init="getData()">
    <!-- Signups View -->
    <div class="container" ng-show="config.lti && course && user">
      <div class="jumbotron text-center">
        <h1>SignUp Lists</h1>
        <div clas="row">
          <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-left">Course: {{course.name}}</div>
          <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-right">User: {{user.name.given}} {{user.name.family}}</div>
        </div>
      </div>

      <div id="printMe" ng-repeat="list in lists">
        <div class="panel" ng-class="list.taken < list.total ? 'panel-default' : 'panel-danger'">
          <div class="panel-heading clearfix">
            <div class="row">
              <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-left">{{list.name}}</div>
              <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-center">{{list.taken}}/{{list.total}} places free</div>
              <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">{{reserveSpaces(list)}} reserve places</div>
            </div>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
                <div>
                  <div>{{list.description}}</div>
                  <div>{{list.location}}</div>
                </div>
                <div ng-show="permissions.viewMembers || config.lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
                  <button class="btn btn-default" ng-show="!list.showMembers" ng-click="list.showMembers = true">View Members</button>
                  <button class="btn btn-default" ng-show="list.showMembers" ng-click="list.showMembers = false">Hide Members</button>
                </div>
                <div ng-show="list.showMembers">
                  <table class="table table-responsive">
                    <thead class="thead-default">
                      <tr>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Group</th>
                        <th>Date Joined</th>
                        <th>Added By</th>
                      </tr>
                    </thead>
                    <tbody ng-repeat="member in list.members">
                      <tr>
                        <th scope="row">{{member.first}}</th>
                        <td>{{member.last}}</td>
                        <td>{{member.email}}</td>
                        <td>{{member.role}}</td>
                        <td>{{member.groupState}}</td>
                        <td>{{member.created | date}}</td>
                        <td>{{member.addedBy}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3" style="text-align:right;">
                <div class="btn-group-vertical" ng-show="config.lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
                  <button class="btn btn-default" ng-click="createGroup(list)">Create Group</button>
                  <button class="btn btn-default" ng-click="addUser(list)">Add User</button>
                  <button class="btn btn-default" ng-click="delUser(list)">Remove User</button>
                  <button class="btn btn-default" ng-click="emailList(list)">Email List</button>
                  <button ng-print print-element-id="printMe" class="btn btn-default" >Print List</button>
                  <button class="btn btn-default" ng-click="exportList(list)">Export List</button>
                </div>
                <div ng-show="config.lti.user_role === 'urn:lti:role:ims/lis/Learner'">
                  <button ng-class="list.taken < list.total ? 'btn btn-default' : 'btn btn-default disabled'"ng-show="!userInList(list)" ng-click="addMe()">Join</button>
                  <button class="btn" ng-show="userInList(list)" ng-click="delMe()">Unjoin</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <!-- <div class="row">
          <div class="col-md-9">
            <div class="row">
              <div class="col-sm-3"><h2>{{list.name}}</h2></div>
              <div class="col-sm-3" style="text-align:center;">{{list.taken}}/{{list.total}} places free</div>
              <div class="col-sm-3" style="text-align:right;"><span style="color:red;">{{reserveSpaces(list)}} reserve places</span></div>
            </div>
            <div>
              <div>{{list.description}}</div>
              <div>{{list.location}}</div>
            </div>
            <div ng-show="permissions.viewMembers || lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
              <button style="width: 125px;" ng-show="!list.showMembers" ng-click="list.showMembers = true">View Members</button>
              <button style="width: 125px;" ng-show="list.showMembers" ng-click="list.showMembers = false">Hide Members</button>
            </div>
            <div ng-show="list.showMembers">
              <table class="table table-responsive">
                <thead class="thead-default">
                  <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Group</th>
                    <th>Date Joined</th>
                    <th>Added By</th>
                  </tr>
                </thead>
                <tbody ng-repeat="member in list.members">
                  <tr>
                    <th scope="row">{{member.first}}</th>
                    <td>{{member.last}}</td>
                    <td>{{member.email}}</td>
                    <td>{{member.role}}</td>
                    <td>{{member.groupState}}</td>
                    <td>{{member.created | date}}</td>
                    <td>{{member.addedBy}}</td>
                  </tr>
                </tbody>
              </table>
              </div>
            </div>
            <div class="col-md-3" style="text-align:right;">
              <div ng-show="lti.user_role === 'urn:lti:role:ims/lis/Instructor'">
                <button style="width: 125px;" ng-click="print(list)">Print List</button><br />
                <button style="width: 125px;" ng-click="exportList(list)">Export List</button><br />
                <button style="width: 125px;" ng-click="createGroup(list)">Create Group</button><br />
                <button style="width: 125px;" ng-click="addUser(list)">Add User</button><br />
                <button style="width: 125px;" ng-click="delUser(list)">Remove User</button>
              </div>
              <div ng-show="lti.user_role === 'urn:lti:role:ims/lis/Learner'">
                <button style="width: 125px;" ng-show="!userInList(list)" ng-click="addMe()">Join</button><br />
                <button style="width: 125px;" ng-show="userInList(list)" ng-click="delMe()">Unjoin</button>
              </div>
            </div>
          </div>
        </div> -->
        <div ng-show="!config.lti || !course || !user">
          <p>Loading...</p>
        </div>
      </div>

    <div ng-if="config.debug_mode">
      <div ng-show="config.lti">
        <h1>Here is the provided LTI data</h1>
        <ul>
          <li>Course UUID : {{config.lti.course_uuid}}</li>
          <li>User UUID : {{config.lti.user_uuid}}</li>
          <li>User Role : {{config.lti.user_role}}</li>
          <li>System GUID : {{config.lti.system_guid}}</li>
          <li>Host : {{config.lti.rest_host}}</li>
          <li>Port : {{config.lti.rest_port}}</li>
          <li>Return URL : {{config.lti.return_url}}</li>
        </ul>
      </div>
      <div ng-show="course">
        <h4>Course</h4>
        <pre>{{course | json}}</pre>
      </div>
      <div ng-show="user">
        <h4>User</h4>
        <pre>{{user | json}}</pre>
      </div>
      <h4>Lists</h4>
      <pre>{{lists | json}}</pre>

      <h4>Permissions</h4>
      <pre>{{permissions | json}}</pre>
    </div>
    <!-- <div ng-controller="SignUpSummaryController">
      <summary-view></summary-view>
    </div> -->

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.23/angular-resource.min.js"></script>

    <script src="./components/ngPrint/ngPrint.min.js"></script>
    <script src="./app.js"></script>
    <script src="./controllers/signup-controller.js"></script>
    <script src="./services/api-service.js"></script>
    <script src="./services/lti-service.js"></script>
    <script src="./services/list-service.js"></script>
    <script src="./directives/summary-view.js"></script>
  </body>
</html>
